import{t as Fs,c as Os,r as n,j as e,a as Ie,S as qs,R as os,u as is,C as Ye,L as me,b as Rs,d as cs,e as pe,f as Ms,$ as Us,V as ds,g as us,A as ms,h as xs,X as hs,T as fs,D as gs,P as $s,i as js,k as Bs,l as re,m as ne,n as le,o as Ee,I as zs,p as He,q as Ce,s as Ks,v as de,w as v,x as F,y as B,z as W,B as Vs,E as ye,F as $,G as Qs,H as ue,J as D,K as De,M as We,N as Xe,O as Gs,Q as ys,U as ge,W as ps,Y as Js,Z as Hs,_ as Ys,a0 as Ws,a1 as Xs,a2 as O,a3 as Q,a4 as G,a5 as z,a6 as Zs,a7 as et,a8 as st,a9 as tt,aa as ss,ab as at,ac as rt,ad as nt,ae as lt,af as ot,ag as it,ah as ct,ai as ws,aj as Se,ak as Ze,al as K,am as xe,an as dt,ao as ut,ap as mt,aq as xt,ar as ht,as as ke,at as vs,au as ft,av as gt,aw as ts,ax as jt,ay as yt,az as pt,aA as wt,aB as vt,aC as Nt,aD as M,aE as bt}from"./nm-fG1cxkjn.js";import"./index-DQ_HVg3t.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))r(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerPolicy&&(c.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?c.credentials="include":l.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(l){if(l.ep)return;l.ep=!0;const c=t(l);fetch(l.href,c)}})();function Va(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function I(...s){return Fs(Os(s))}const Ct=Ie("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),Te=n.forwardRef(({className:s,variant:a,...t},r)=>e.jsx("div",{ref:r,role:"alert",className:I(Ct({variant:a}),s),...t}));Te.displayName="Alert";const St=n.forwardRef(({className:s,...a},t)=>e.jsx("h5",{ref:t,className:I("mb-1 font-medium leading-none tracking-tight",s),...a}));St.displayName="AlertTitle";const Pe=n.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:I("text-sm [&_p]:leading-relaxed",s),...a}));Pe.displayName="AlertDescription";const kt=Ie("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),ae=n.forwardRef(({className:s,variant:a,size:t,asChild:r=!1,...l},c)=>{const i=r?qs:"button";return e.jsx(i,{className:I(kt({variant:a,size:t,className:s})),ref:c,...l})});ae.displayName="Button";const he=n.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:I("rounded-lg border bg-card text-card-foreground shadow-sm",s),...a}));he.displayName="Card";const Ae=n.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:I("flex flex-col space-y-1.5 p-6",s),...a}));Ae.displayName="CardHeader";const Le=n.forwardRef(({className:s,...a},t)=>e.jsx("h3",{ref:t,className:I("text-2xl font-semibold leading-none tracking-tight",s),...a}));Le.displayName="CardTitle";const _e=n.forwardRef(({className:s,...a},t)=>e.jsx("p",{ref:t,className:I("text-sm text-muted-foreground",s),...a}));_e.displayName="CardDescription";const Fe=n.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:I("p-6 pt-0",s),...a}));Fe.displayName="CardContent";const Oe=n.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:I("flex items-center p-6 pt-0",s),...a}));Oe.displayName="CardFooter";const H=n.forwardRef(({className:s,type:a,...t},r)=>e.jsx("input",{type:a,className:I("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:r,...t}));H.displayName="Input";const It=Ie("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Y=n.forwardRef(({className:s,...a},t)=>e.jsx(os,{ref:t,className:I(It(),s),...a}));Y.displayName=os.displayName;const Et=1,Dt=1e6;let Ge=0;function Tt(){return Ge=(Ge+1)%Number.MAX_SAFE_INTEGER,Ge.toString()}const Je=new Map,as=s=>{if(Je.has(s))return;const a=setTimeout(()=>{Je.delete(s),je({type:"REMOVE_TOAST",toastId:s})},Dt);Je.set(s,a)},Pt=(s,a)=>{switch(a.type){case"ADD_TOAST":return{...s,toasts:[a.toast,...s.toasts].slice(0,Et)};case"UPDATE_TOAST":return{...s,toasts:s.toasts.map(t=>t.id===a.toast.id?{...t,...a.toast}:t)};case"DISMISS_TOAST":{const{toastId:t}=a;return t?as(t):s.toasts.forEach(r=>{as(r.id)}),{...s,toasts:s.toasts.map(r=>r.id===t||t===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return a.toastId===void 0?{...s,toasts:[]}:{...s,toasts:s.toasts.filter(t=>t.id!==a.toastId)}}},Ne=[];let be={toasts:[]};function je(s){be=Pt(be,s),Ne.forEach(a=>{a(be)})}function At({...s}){const a=Tt(),t=l=>je({type:"UPDATE_TOAST",toast:{...l,id:a}}),r=()=>je({type:"DISMISS_TOAST",toastId:a});return je({type:"ADD_TOAST",toast:{...s,id:a,open:!0,onOpenChange:l=>{l||r()}}}),{id:a,dismiss:r,update:t}}function qe(){const[s,a]=n.useState(be);return n.useEffect(()=>(Ne.push(a),()=>{const t=Ne.indexOf(a);t>-1&&Ne.splice(t,1)}),[s]),{...s,toast:At,dismiss:t=>je({type:"DISMISS_TOAST",toastId:t})}}const rs={method:"GET",headers:{},credentials:"include"},Lt="https://cowboy-cards.dsouth.org";async function N(s="",a=rs){const t={...rs,...a};try{const r=await fetch(Lt+s,t);if(!r.ok){console.log("resp",r);const c=await r.text();throw new Error(`HTTP error! Status: ${r.status}, Message: ${c}`)}return r.status===204?null:await r.json()}catch(r){throw console.error("API request failed:",r),r}}const _t="modulepreload",Ft=function(s,a){return new URL(s,a).href},ns={},Qa=function(a,t,r){let l=Promise.resolve();if(t&&t.length>0){const i=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),m=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));l=Promise.allSettled(t.map(o=>{if(o=Ft(o,r),o in ns)return;ns[o]=!0;const d=o.endsWith(".css"),f=d?'[rel="stylesheet"]':"";if(!!r)for(let h=i.length-1;h>=0;h--){const g=i[h];if(g.href===o&&(!d||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${f}`))return;const y=document.createElement("link");if(y.rel=d?"stylesheet":_t,d||(y.as="script"),y.crossOrigin="",y.href=o,m&&y.setAttribute("nonce",m),document.head.appendChild(y),d)return new Promise((h,g)=>{y.addEventListener("load",h),y.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${o}`)))})}))}function c(i){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=i,window.dispatchEvent(u),!u.defaultPrevented)throw i}return l.then(i=>{for(const u of i||[])u.status==="rejected"&&c(u.reason);return a().catch(c)})},Ns=()=>{const[s,a]=n.useState(!0),[t,r]=n.useState(!1),[l,c]=n.useState(""),[i,u]=n.useState(""),[m,o]=n.useState(""),[d,f]=n.useState(""),[x,y]=n.useState(""),[h,g]=n.useState({}),j=is(),{toast:b}=qe(),p=()=>{const S={};let T=!0;return l?/\S+@\S+\.\S+/.test(l)||(S.email="Email is invalid",T=!1):(S.email="Email is required",T=!1),i?i.length<8&&(S.password="Password must be at least 8 characters",T=!1):(S.password="Password is required",T=!1),!s&&!m&&(S.username="Username is required",T=!1),g(S),T},V=async S=>{if(S.preventDefault(),!!p()){r(!0),g({});try{let T;s?T=await N("/login",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({email:l,password:i})}):T=await N("/signup",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({username:m,email:l,password:i,first_name:d,last_name:x})}),b({duration:8e3,title:s?"Welcome back!":"Account created",description:s?"You have been successfully logged in.":"Your account has been created successfully."}),j.push("/home")}catch(T){console.error("Authentication error:",T),g(T),Object.keys(h).length===0&&g({general:T.message||"An unexpected error occurred. Please try again."}),b({title:"Authentication failed",description:T.message||"Please check your credentials and try again.",variant:"destructive"})}finally{r(!1)}}},q=()=>{g({}),s?(o(""),f(""),y("")):(c(""),u(""))};return e.jsxs(he,{className:"w-11/12 max-w-[350px] mb-8",children:[e.jsxs(Ae,{children:[e.jsx(Le,{className:"text-4xl tracking-wide font-smokum font-bold",children:s?"Welcome back":"Create account"}),e.jsx(_e,{children:s?"Enter your credentials to continue":"Sign up for a new account"})]}),e.jsxs("form",{onSubmit:V,children:[e.jsxs(Fe,{className:"space-y-4",children:[h.general&&e.jsxs(Te,{variant:"destructive",className:"mb-4",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx(Pe,{children:h.general})]}),!s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"username",children:"Username"}),e.jsx(H,{id:"username",type:"text",placeholder:"johndoe",value:m,onChange:S=>o(S.target.value),required:!0,className:h.username?"border-red-500":""}),h.username&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.username})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"firstName",children:"First Name"}),e.jsx(H,{id:"firstName",type:"text",placeholder:"John",value:d,onChange:S=>f(S.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"lastName",children:"Last Name"}),e.jsx(H,{id:"lastName",type:"text",placeholder:"Doe",value:x,onChange:S=>y(S.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"email",children:"Email"}),e.jsx(H,{id:"email",type:"email",placeholder:"name@example.com",value:l,onChange:S=>c(S.target.value),required:!0,className:h.email?"border-red-500":""}),h.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"password",children:"Password"}),e.jsx(H,{id:"password",type:"password",value:i,onChange:S=>u(S.target.value),required:!0,className:h.password?"border-red-500":""}),h.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:h.password}),!s&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Password must be at least 8 characters long"})]}),s&&e.jsx(me,{to:"/reset-password",className:"text-sm text-primary",children:"Forgot password?"})]}),e.jsxs(Oe,{className:"flex flex-col space-y-4",children:[e.jsxs(ae,{type:"submit",className:"w-full",disabled:t,children:[e.jsx(Rs,{className:"mr-2 h-4 w-4"}),t?s?"Signing in...":"Signing up...":s?"Sign in":"Sign up"]}),e.jsx(ae,{variant:"link",type:"button",onClick:()=>{a(!s),q()},className:"text-sm",disabled:t,children:s?"Need an account? Sign up":"Already have an account? Sign in"})]})]})]})},Ot=()=>{var j;const a=((j=cs().state)==null?void 0:j.email)||"",[t,r]=n.useState(""),[l,c]=n.useState(""),[i,u]=n.useState(""),[m,o]=n.useState(!1),[d,f]=n.useState({}),x=pe(),{toast:y}=qe(),h=()=>{const b={};let p=!0;return i||(b.token="Reset token is required",p=!1),t?t.length<8&&(b.password="Password must be at least 8 characters",p=!1):(b.password="Password is required",p=!1),l?t!==l&&(b.confirmPassword="Passwords do not match",p=!1):(b.confirmPassword="Please confirm your password",p=!1),f({...d,...b}),p},g=async b=>{if(b.preventDefault(),!!h()){o(!0),f({});try{await N("/reset-password/confirm",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,token:i,password:t})}),y({title:"Password reset successful",description:"Your password has been reset. You can now log in with your new password."}),x.push("/auth")}catch(p){console.error("Password reset error:",p),p.message==="Invalid token"?f({token:"Invalid or expired token"}):f({general:p.message||"An error occurred during password reset. Please try again."}),y({title:"Password reset failed",description:p.message||"Please check your inputs and try again.",variant:"destructive"})}finally{o(!1)}}};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs(he,{className:"w-[350px]",children:[e.jsxs(Ae,{children:[e.jsx(Le,{children:"Reset Your Password"}),e.jsx(_e,{children:"Enter your new password and the reset token sent to your email"})]}),e.jsxs("form",{onSubmit:g,children:[e.jsxs(Fe,{className:"space-y-4",children:[d.general&&e.jsxs(Te,{variant:"destructive",className:"mb-4",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx(Pe,{children:d.general})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"token",children:"Reset Token"}),e.jsx(H,{id:"token",type:"text",placeholder:"Enter the token from your email",value:i,onChange:b=>u(b.target.value),required:!0,className:d.token?"border-red-500":""}),d.token&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.token})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"password",children:"New Password"}),e.jsx(H,{id:"password",type:"password",placeholder:"Enter your new password",value:t,onChange:b=>r(b.target.value),required:!0,className:d.password?"border-red-500":""}),d.password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.password}),e.jsx("p",{className:"text-xs text-gray-500",children:"Password must be at least 8 characters long"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{htmlFor:"confirmPassword",children:"Confirm Password"}),e.jsx(H,{id:"confirmPassword",type:"password",placeholder:"Confirm your new password",value:l,onChange:b=>c(b.target.value),required:!0,className:d.confirmPassword?"border-red-500":""}),d.confirmPassword&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:d.confirmPassword})]})]}),e.jsx(Oe,{className:"flex flex-col space-y-4",children:e.jsx(ae,{type:"submit",className:"w-full",disabled:m,children:m?"Processing...":"Reset Password"})})]})]})})},qt=()=>{const[s,a]=n.useState(""),[t,r]=n.useState({}),[l,c]=n.useState(!1),{toast:i}=qe(),u=pe(),m=()=>{const d={};let f=!0;return s?/\S+@\S+\.\S+/.test(s)||(d.email="Email is invalid",f=!1):(d.email="Email is required",f=!1),r(d),f},o=async d=>{if(d.preventDefault(),!!m()){c(!0),r({});try{await N("/reset-password/request",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:s})}),i({title:"Reset token sent",description:"If the email exists in our system, a reset token has been sent to it."}),u.push("/confirm-reset-password",{email:s})}catch(f){console.error("Reset password request error:",f),r({general:"An error occurred while processing your request. Please try again."}),i({title:"Reset request failed",description:"Please try again later.",variant:"destructive"})}finally{c(!1)}}};return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-100",children:e.jsxs(he,{className:"w-11/12 max-w-[350px]",children:[e.jsxs(Ae,{children:[e.jsx(Le,{className:"text-4xl tracking-wide font-smokum font-bold",children:"Reset Password"}),e.jsx(_e,{children:"Enter your email to reset your password"})]}),e.jsxs("form",{onSubmit:o,children:[e.jsxs(Fe,{className:"space-y-4",children:[t.general&&e.jsxs(Te,{variant:"destructive",className:"mb-4",children:[e.jsx(Ye,{className:"h-4 w-4"}),e.jsx(Pe,{children:t.general})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Y,{className:"text-3xl tracking-wide font-smokum font-bold",htmlFor:"email",children:"Email"}),e.jsx(H,{id:"email",type:"email",placeholder:"name@example.com",value:s,onChange:d=>a(d.target.value),required:!0,className:t.email?"border-red-500":""}),t.email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:t.email})]})]}),e.jsx(Oe,{className:"flex flex-col space-y-4",children:e.jsx(ae,{type:"submit",className:"w-full",disabled:l,children:l?"Sending...":"Send Reset Token"})})]})]})})},Rt=({...s})=>{const{theme:a="system"}=Ms();return e.jsx(Us,{theme:a,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...s})},Mt=$s,bs=n.forwardRef(({className:s,...a},t)=>e.jsx(ds,{ref:t,className:I("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",s),...a}));bs.displayName=ds.displayName;const Ut=Ie("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),Cs=n.forwardRef(({className:s,variant:a,...t},r)=>e.jsx(us,{ref:r,className:I(Ut({variant:a}),s),...t}));Cs.displayName=us.displayName;const $t=n.forwardRef(({className:s,...a},t)=>e.jsx(ms,{ref:t,className:I("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",s),...a}));$t.displayName=ms.displayName;const Ss=n.forwardRef(({className:s,...a},t)=>e.jsx(xs,{ref:t,className:I("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",s),"toast-close":"",...a,children:e.jsx(hs,{className:"h-4 w-4"})}));Ss.displayName=xs.displayName;const ks=n.forwardRef(({className:s,...a},t)=>e.jsx(fs,{ref:t,className:I("text-sm font-semibold",s),...a}));ks.displayName=fs.displayName;const Is=n.forwardRef(({className:s,...a},t)=>e.jsx(gs,{ref:t,className:I("text-sm opacity-90",s),...a}));Is.displayName=gs.displayName;function Bt(){const{toasts:s}=qe();return e.jsxs(Mt,{children:[s.map(function({id:a,title:t,description:r,action:l,...c}){return e.jsxs(Cs,{...c,children:[e.jsxs("div",{className:"grid gap-1",children:[t&&e.jsx(ks,{children:t}),r&&e.jsx(Is,{children:r})]}),l,e.jsx(Ss,{})]},a)}),e.jsx(bs,{})]})}const zt=Bs,Kt=n.forwardRef(({className:s,sideOffset:a=4,...t},r)=>e.jsx(js,{ref:r,sideOffset:a,className:I("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...t}));Kt.displayName=js.displayName;const Es=n.createContext(void 0);function Vt({children:s}){const[a,t]=n.useState(()=>localStorage.getItem("theme")||"light");return n.useEffect(()=>{localStorage.setItem("theme",a),a==="dark"?(document.documentElement.classList.add("dark"),document.body.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"))},[a]),e.jsx(Es.Provider,{value:{theme:a,setTheme:t},children:s})}function Ds(){const s=n.useContext(Es);if(s===void 0)throw new Error("useTheme must be used within a ThemeProvider");return s}function Qt(s){return re({queryKey:["class",s],queryFn:()=>N("/api/classes/",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function Gt(s){return re({queryKey:["classSets",s],queryFn:()=>N("/api/class_set/list_sets",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function Jt(s){return re({queryKey:["classMembers",s],queryFn:()=>N("/api/class_user/members",{method:"GET",headers:{class_id:s}}),staleTime:5*60*1e3})}function Ht(s){return re({queryKey:["classLeaderboard",s],queryFn:()=>N("/api/classes/leaderboard",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function Yt(){return re({queryKey:["userSets"],queryFn:()=>N("/api/set_user/list"),staleTime:5*60*1e3})}function Wt(){const s=ne();return le({mutationFn:({id:a,field:t,value:r})=>N(`/api/classes/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["class",t.id]})}})}function Xt(s){const a=ne();return le({mutationFn:t=>N("/api/class_user/",{method:"DELETE",headers:{student_id:t,class_id:s}}),onSuccess:()=>{a.invalidateQueries({queryKey:["classMembers",s]})}})}function Zt(){const s=ne();return le({mutationFn:({classId:a,setId:t})=>N("/api/class_set/",{method:"POST",headers:{class_id:a,set_id:t.toString()}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["classSets",t.classId]})}})}const ea=s=>{const[a,t]=n.useState(null),[r]=Ee(),{data:l=[],isLoading:c,error:i}=Yt(),u=Zt();console.log("userSets",l),console.log("addSetMutation",u.data);const m=Array.isArray(l)?l.filter(x=>Array.isArray(s.existingSetIds)?!s.existingSetIds.includes(x.SetID):!0):[];n.useEffect(()=>{s.isOpen||t(null)},[s.isOpen]);const o=async()=>{if(!a||!s.classId){r({message:"Please select a set to add.",duration:2e3,color:"warning"});return}try{await u.mutateAsync({classId:s.classId,setId:a}),r({message:"Set added successfully!",duration:2e3,color:"success"}),s.onDidDismiss()}catch(x){const y=`Failed to add set: ${x instanceof Error?x.message:"Unknown error"}`;r({message:y,duration:3e3,color:"danger"})}},d=c||u.isPending,f=i||u.error;return console.log("availableSets",m),e.jsxs(zs,{isOpen:s.isOpen,onDidDismiss:s.onDidDismiss,children:[e.jsx(He,{children:e.jsxs(Ce,{children:[e.jsx(Ks,{children:"Add Set to Class"}),e.jsx(de,{slot:"end",children:e.jsx(v,{onClick:s.onDidDismiss,color:"medium",children:"Cancel"})})]})}),e.jsxs(F,{children:[d&&!(m!=null&&m.length)?e.jsxs("div",{className:"flex justify-center items-center h-full",children:[e.jsx(B,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading your sets..."})]}):f?e.jsx(W,{color:"danger",children:e.jsx("p",{children:f instanceof Error?f.message:String(f)})}):(m==null?void 0:m.length)===0?e.jsx("p",{className:"text-center text-gray-500 mt-4",children:"You have no available sets to add to this class. Create a new set or check if all your sets are already added."}):e.jsx(Vs,{value:a,onIonChange:x=>{t(Number(x.detail.value))},children:e.jsx(ye,{children:m==null?void 0:m.map(x=>e.jsxs($,{children:[e.jsx(Qs,{slot:"start",value:x.SetID},x.SetID),e.jsxs(ue,{children:[e.jsx("h2",{children:x.SetName}),e.jsx("p",{className:"text-sm text-gray-500",children:x.SetDescription})]})]},x.SetID))})}),f&&(m==null?void 0:m.length)>0&&e.jsx(W,{color:"danger",className:"block mt-4",children:e.jsx("p",{children:f instanceof Error?f.message:String(f)})})]}),!d&&(m==null?void 0:m.length)>0&&e.jsx("div",{className:"ion-padding",children:e.jsx(v,{expand:"block",onClick:o,disabled:!a||u.isPending,className:"ion-margin-bottom",children:u.isPending?e.jsx(B,{name:"dots"}):"Add Selected Set"})})]})},sa=s=>e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs(v,{routerLink:"/home",color:"primary",children:[e.jsx(D,{slot:"start",icon:De}),"Back"]}),s.isTeacher&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:s.onAddSetClick,color:"primary",disabled:!s.classId,children:[e.jsx(D,{slot:"start",icon:We}),"Add Existing Set"]}),e.jsxs(v,{routerLink:`/create-set?classId=${s.classId}`,color:"primary",disabled:!s.classId,children:[e.jsx(D,{slot:"start",icon:Xe}),"Create New Set"]})]})]}),oe=s=>e.jsxs("div",{children:[e.jsx($,{children:e.jsx(Gs,{type:s.type,label:s.label,name:s.name,value:s.value,onIonChange:s.onChange})}),s.error&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.error})]}),ta=s=>e.jsx(e.Fragment,{children:s.isEditing?e.jsxs(e.Fragment,{children:[e.jsx(oe,{type:"text",label:"Class Name",name:"class_name",value:s.updatedInfo.class_name,onChange:s.handleChange,error:s.formErrors.className}),e.jsx(oe,{type:"text",label:"Class Description",name:"class_description",value:s.updatedInfo.class_description,onChange:s.handleChange,error:s.formErrors.classDescription}),s.formErrors.general&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.formErrors.general}),e.jsxs("div",{className:"mt-4 flex justify-end space-x-2",children:[e.jsx(v,{onClick:s.handleSave,color:"primary",size:"small",children:"Save"}),e.jsx(v,{onClick:s.handleCancel,color:"medium",size:"small",children:"Cancel"})]})]}):s.loading?e.jsx("div",{children:"Loading..."}):s.classData?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.loading?"Loading...":s.classData.ClassName}),s.isTeacher&&!s.isEditing&&e.jsx(D,{icon:Xe,size:"large",color:"primary",className:"hover:transform hover:scale-110 cursor-pointer p-2",onClick:s.handleEdit})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:s.loading?"Loading...":s.classData.ClassDescription})]}):e.jsx("h1",{children:"Class details unavailable"})}),aa=s=>e.jsxs(ys,{value:s.selectedTab,onIonChange:a=>s.onTabChange(a.detail.value),className:"w-full mb-6",children:[e.jsxs(ge,{value:"flashcards",children:[e.jsx(D,{icon:ps,className:"mr-2"}),e.jsx(ue,{children:"Flashcard Sets"})]}),e.jsxs(ge,{value:"leaderboard",children:[e.jsx(D,{icon:Js,className:"mr-2"}),e.jsx(ue,{children:"Leaderboard"})]}),e.jsxs(ge,{value:"students",children:[e.jsx(D,{icon:Hs,className:"mr-2"}),e.jsx(ue,{children:"Students"})]})]}),ra=s=>{var l,c;const a=pe(),[t,r]=n.useState([]);return e.jsx("div",{className:"mt-6",children:s.loading?e.jsx("div",{children:"Loading..."}):(l=s.flashcardSets)!=null&&l.length?e.jsx(Ys,{children:e.jsx(Ws,{children:(c=s.flashcardSets.sort((i,u)=>i.ID-u.ID))==null?void 0:c.map(i=>e.jsx(Xs,{size:"12",sizeMd:"6",sizeLg:"4",children:e.jsxs(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-all duration-200 rounded-lg border shadow-sm",onClick:()=>a.push(`/set-overview/${i.ID}`),children:[e.jsx(Q,{children:e.jsx(G,{className:"text-lg font-semibold",children:i.SetName})}),e.jsx(z,{children:e.jsx("p",{className:"text-muted-foreground mb-2",children:i.SetDescription})})]})},i.ID))})}):e.jsx("p",{children:"No flashcard sets available. Create one or add an existing set to your class."})})},X=()=>e.jsx(Zs,{className:" ion-no-border",children:e.jsxs(Ce,{children:[e.jsx(de,{slot:"start",children:e.jsx(v,{children:e.jsx(me,{to:"/home",children:e.jsx(D,{icon:et})})})}),e.jsx(W,{className:"mx-auto text-center text-sm",children:"Â©Cowboy Cards 2025. Built for learning and fun."})]})}),na=s=>{var a;return e.jsxs(O,{className:"rounded-lg border shadow-sm",children:[e.jsx(Q,{children:e.jsx(G,{className:"text-xl font-semibold",children:"Class Leaderboard"})}),e.jsx(z,{children:e.jsx(ye,{className:"max-h-96 overflow-y-auto space-y-3",lines:"none",children:s.leaderboard===null?e.jsx("h1",{className:"text-center text-gray-500",children:"No scores available"}):(a=s.leaderboard)==null?void 0:a.map((t,r)=>e.jsx(st.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:r*.1},children:e.jsxs($,{className:"muted-item p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r===0&&e.jsx("span",{className:"text-yellow-500 text-xl",children:"ðŸ¥‡"}),r===1&&e.jsx("span",{className:"text-gray-400 text-xl",children:"ðŸ¥ˆ"}),r===2&&e.jsx("span",{className:"text-orange-500 text-xl",children:"ðŸ¥‰"}),e.jsx("span",{className:"font-medium text-lg",children:t.Username})]}),e.jsxs("span",{slot:"end",className:"text-primary font-semibold",children:[t.ClassScore," points"]})]})},t.UserID))})})]})},la=s=>e.jsx(e.Fragment,{children:s.loadingScores?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(B,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Calculating scores..."})]}):e.jsx(na,{leaderboard:s.leaderboardData})}),J=()=>{const[s,a]=n.useState(null),t=o=>a(o.nativeEvent),r=()=>a(null),l=o=>{var d;c.push(o),(d=document.querySelector("ion-menu"))==null||d.close()},c=is(),{theme:i,setTheme:u}=Ds(),m=()=>{u(i==="dark"?"light":"dark")};return e.jsxs(e.Fragment,{children:[e.jsxs(tt,{side:"start",contentId:"main-content",children:[e.jsx(He,{children:e.jsx(Ce,{children:e.jsx(de,{slot:"start",children:e.jsx(ss,{children:e.jsx(v,{children:e.jsx(D,{icon:at})})})})})}),e.jsx(F,{children:e.jsxs(ye,{children:[e.jsx($,{button:!0,onClick:()=>l("/home"),children:"My Dashboard"}),e.jsx($,{button:!0,onClick:()=>l("/public-cards"),children:"Public Cards"}),e.jsx($,{button:!0,onClick:()=>l("/public-classes"),children:"Public Classes"}),e.jsx($,{button:!0,onClick:()=>l("/user-account"),children:"My Account"})]})})]}),e.jsx(He,{children:e.jsxs(Ce,{children:[e.jsx(de,{slot:"start",children:e.jsx(ss,{children:e.jsx(v,{children:e.jsx(D,{icon:rt})})})}),e.jsxs("div",{className:"cursor-pointer",onClick:()=>c.push("/home"),children:[e.jsx("img",{src:"/Spirit-Cowboy-Profile-Only.png",alt:"Cowboy Cards Logo",className:"h-8 w-auto me:hidden block"}),e.jsx("h2",{className:"hidden me:block text-2xl sm:text-3xl md:text-4xl text-ellipsis overflow-hidden whitespace-nowrap font-ewert text-[color:--ion-color-primary]",children:"Cowboy Cards"})]}),e.jsxs(de,{slot:"end",children:[e.jsx(v,{onClick:t,children:e.jsx(D,{icon:nt,className:"text-[32px] stroke-[2]"})}),e.jsx(lt,{event:s,isOpen:!!s,onDidDismiss:r,children:e.jsx(F,{children:e.jsxs(ye,{children:[e.jsx($,{button:!0,onClick:()=>{r(),c.push("/create-set")},children:"Create Set"}),e.jsx($,{button:!0,onClick:()=>{r(),c.push("/create-class")},children:"Create Class"}),e.jsx($,{button:!0,onClick:()=>{r(),c.push("/public-classes")},children:"Join Class"})]})})}),e.jsx(v,{fill:"clear",onClick:m,children:e.jsx(D,{slot:"icon-only",icon:i==="dark"?ot:it})})]}),e.jsx(de,{slot:"end",children:e.jsx(v,{routerLink:"/user-account",children:e.jsx(D,{icon:ct,size:"large"})})})]})})]})},oa=s=>{var a;return e.jsxs(O,{className:"mt-6",children:[e.jsx(Q,{children:e.jsx(G,{className:"text-xl font-semibold",children:"Class Students"})}),e.jsx(z,{children:e.jsx(ye,{className:"space-y-3",lines:"none",children:(a=s.students)==null?void 0:a.map(t=>e.jsxs($,{className:"muted-item p-3",children:[e.jsxs("span",{className:"font-medium",children:[t.FirstName," ",t.LastName]}),e.jsx("span",{slot:"end",className:"text-muted-foreground",children:t.email}),s.isTeacher&&e.jsx(D,{slot:"end",icon:ws,color:"danger",className:"cursor-pointer",onClick:()=>s.onDeleteStudent(t.UserID)})]},t.UserID))})})]})},ia=s=>{const[a,t]=n.useState({isOpen:!1,studentId:null}),r=l=>{t({isOpen:!0,studentId:l})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col",children:e.jsx(oa,{isTeacher:s.isTeacher,students:s.students,onDeleteStudent:r})}),e.jsx(Se,{isOpen:a.isOpen,onDidDismiss:()=>t({isOpen:!1,studentId:null}),header:"Confirm Deletion",message:"Are you sure you want to remove this student from the class? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Delete",handler:()=>{a.studentId!==null&&(s.handleActualDelete(a.studentId),console.log(`Student deletion initiated for ID: ${a.studentId}`))}}]})]})},ca=()=>{const{id:s}=Ze(),[a,t]=n.useState(0),[r,l]=n.useState(),[c,i]=n.useState("flashcards"),[u,m]=n.useState(!1),[o,d]=n.useState({class_name:"",class_description:""}),[f,x]=n.useState(!1),[y,h]=n.useState({}),{data:g,isLoading:j,error:b}=Qt(s),{data:p=[],isLoading:V,error:q}=Gt(s),{data:S=[],isLoading:T,error:Z}=Jt(s),{data:ie=[],isLoading:ee,error:E}=Ht(s),k=Wt(),U=Xt(s),_=(g==null?void 0:g.Role)==="teacher",Me=()=>{d({class_name:(g==null?void 0:g.ClassName)||"",class_description:(g==null?void 0:g.ClassDescription)||""}),m(!0)},Ue=()=>{const R={};let se=!0;return o.class_name=o.class_name.trim(),o.class_description=o.class_description.trim(),o.class_name||(R.className="Class name is required",se=!1),o.class_description||(R.classDescription="Class description is required",se=!1),h(R),se},$e=async()=>{if(Ue())try{await Promise.all([k.mutateAsync({id:s,field:"class_name",value:o.class_name}),k.mutateAsync({id:s,field:"class_description",value:o.class_description})]),m(!1)}catch{alert("Failed to update some fields. Please try again.")}},Be=R=>{const{name:se}=R.target,Ve=R.detail.value;d(C=>({...C,[se]:Ve}))},ze=()=>{m(!1)},Ke=async R=>{if(R!==null)try{await U.mutateAsync(R)}catch{alert("Error deleting student")}};n.useEffect(()=>{r&&r.on("select",()=>{t(r.selectedScrollSnap())})},[r]);const we=j||V||T||ee,ve=b||q||Z||E;return e.jsxs(K,{children:[e.jsx(J,{}),e.jsxs(F,{className:"ion-padding",children:[e.jsxs("div",{id:"main-content",className:"max-w-4xl mx-auto",children:[ve&&e.jsx("div",{className:"text-red-500",children:ve.message}),e.jsx(ta,{classData:g,isTeacher:_,loading:we,handleEdit:Me,isEditing:u,updatedInfo:o,formErrors:y,handleChange:Be,handleSave:$e,handleCancel:ze}),e.jsx(sa,{isTeacher:_,classId:s,onAddSetClick:()=>x(!0)}),e.jsx(aa,{selectedTab:c,onTabChange:i}),c==="leaderboard"&&e.jsx(la,{leaderboardData:ie,loadingScores:ee}),c==="flashcards"&&e.jsx(ra,{flashcardSets:p,currentCardIndex:a,setApi:l,loading:we}),c==="students"&&e.jsx(ia,{isTeacher:_,students:S,handleActualDelete:Ke})]}),e.jsx(ea,{isOpen:f,onDidDismiss:()=>x(!1),classId:s,existingSetIds:(p==null?void 0:p.map(R=>R.ID))||[]})]}),e.jsx(X,{})]})},da=()=>{const[s,a]=n.useState(!1),[t,r]=n.useState(!1),[l,c]=n.useState(null),[i,u]=n.useState({className:"",description:""}),[m,o]=n.useState(!1);return n.useEffect(()=>{async function d(){if(s){r(!0),c(null);try{const f=await N("/api/classes",{method:"POST",headers:{class_name:i.className,class_description:i.description}});console.log("Class created successfully:",f),a(!1),u({className:"",description:""}),o(!0),r(!1)}catch(f){c(`Failed to create class: ${f.message}`)}finally{r(!1)}}}s&&d()},[s,i]),e.jsxs(K,{children:[e.jsxs(F,{children:[e.jsx(J,{}),e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8",children:[l&&e.jsx("div",{className:"text-red-500 mt-2",children:l}),e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum mb-6",children:"Create New Class"}),e.jsxs("form",{children:[e.jsx(O,{className:"mb-6 rounded-lg border shadow-sm",children:e.jsxs(z,{children:[e.jsx(xe,{placeholder:"Enter Class Name",value:i.className,onIonChange:d=>u(f=>({...f,className:d.detail.value||""})),rows:1,autoGrow:!0,className:"w-full text-xl font-bold mb-2",style:{resize:"none"}}),e.jsx(xe,{placeholder:"Enter Class Description",value:i.description,onIonChange:d=>u(f=>({...f,description:d.detail.value||""})),rows:1,autoGrow:!0,className:"w-full text-base mt-4",style:{resize:"none"}})]})}),e.jsx("div",{className:"flex flex-col md:flex-row justify-center md:justify-end gap-4 mt-8",children:e.jsx(v,{color:"success",disabled:t,onClick:()=>a(!0),children:t?"Creating...":"Create Class"})})]}),m&&e.jsx(W,{children:e.jsx("p",{children:"Class created successfully!"})})]})]}),e.jsx(X,{})]})},ua=()=>{const s=pe(),[a,t]=n.useState(""),[r,l]=n.useState(""),[c,i]=n.useState({title:"",description:""}),[u,m]=n.useState(!1),[o,d]=n.useState(null),f=async()=>{m(!0),d(null);const x={title:"",description:""};let y=!1;if(a.trim()||(x.title="Title is required",y=!0),r.trim()||(x.description="Description is required",y=!0),i(x),y){m(!1);return}try{const h=await N("/api/flashcards/sets",{method:"POST",headers:{set_name:a,set_description:r}});s.push(`/set-overview/${h.ID}`)}catch(h){console.error("Error saving flashcard set:",h),d(`Failed to save flashcard set: ${h.message}`)}finally{m(!1)}};return e.jsxs(K,{children:[e.jsxs(F,{className:"",children:[e.jsx(J,{}),e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 max-w-4xl",children:[u&&e.jsx("div",{children:"Loading..."}),o&&e.jsx("div",{className:"text-red-500 mt-2",children:o}),e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum mb-6",children:"Create New Flashcard Set"}),e.jsx(O,{className:"mb-6 rounded-lg border shadow-sm",children:e.jsxs(z,{children:[e.jsx(xe,{placeholder:"Enter set title",value:a,onIonChange:x=>t(x.detail.value),rows:1,autoGrow:!0,className:"w-full text-xl font-bold mb-2",style:{resize:"none"}}),c.title&&e.jsx(W,{color:"danger",children:e.jsx("p",{className:"text-sm mt-1",children:c.title})}),e.jsx(xe,{placeholder:"Enter set description",value:r,onIonChange:x=>l(x.detail.value),rows:1,autoGrow:!0,className:"w-full text-base mt-4",style:{resize:"none"}}),c.description&&e.jsx(W,{color:"danger",children:e.jsx("p",{className:"text-sm mt-1",children:c.description})})]})}),e.jsx("div",{className:"flex justify-center",children:e.jsx(v,{color:"success",className:"rounded-lg shadow-sm w-full md:w-auto",onClick:f,disabled:u,children:u?"Creating...":"Create Set"})})]})]}),e.jsx(X,{})]})};function ma(s){return re({queryKey:["flashcardSet",s],queryFn:()=>N("/api/flashcards/sets/",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function xa(s){return re({queryKey:["flashcardCards",s],queryFn:()=>N("/api/flashcards/list",{method:"GET",headers:{set_id:s}}),staleTime:5*60*1e3})}function ha(){return ne(),le({mutationFn:({cardId:s,isCorrect:a})=>N(a?"/api/card_history/correct":"/api/card_history/incorrect",{method:"POST",headers:{card_id:s.toString()}})})}const fa=s=>{const[a,t]=n.useState(!1),r=ha(),l=async u=>{var m;try{await r.mutateAsync({cardId:s.cardId,isCorrect:u}),console.log(`Score update successful for card ${s.cardId}`),(m=s.onAdvance)==null||m.call(s)}catch(o){console.error(`Failed to update score for card ${s.cardId}:`,o)}},c=()=>{l(!1)},i=()=>{l(!0)};return e.jsxs("div",{className:"w-full max-w-md mx-auto",children:[e.jsxs("div",{className:`flip-card cursor-pointer ${a?"flipped":""}`,onClick:()=>t(!a),children:[e.jsx(he,{className:"flip-card-front p-8 min-h-[300px] flex items-center justify-center text-center",children:e.jsx("p",{className:"text-xl",children:s.front})}),e.jsx(he,{className:"flip-card-back p-8 min-h-[300px] flex items-center justify-center text-center absolute top-0 w-full",children:e.jsx("p",{className:"text-xl",children:s.back})})]}),e.jsxs("div",{className:"flex justify-center gap-4 mt-6",children:[e.jsxs(ae,{variant:"outline",className:"w-32",onClick:c,children:[e.jsx(hs,{className:"mr-2 h-4 w-4"}),"Learning"]}),e.jsxs(ae,{className:"w-32",onClick:i,children:[e.jsx(dt,{className:"mr-2 h-4 w-4"}),"Mastered"]})]})]})},Ts=n.createContext(null);function Re(){const s=n.useContext(Ts);if(!s)throw new Error("useCarousel must be used within a <Carousel />");return s}const Ps=n.forwardRef(({orientation:s="horizontal",opts:a,setApi:t,plugins:r,className:l,children:c,...i},u)=>{const[m,o]=ut({...a,axis:s==="horizontal"?"x":"y"},r),[d,f]=n.useState(!1),[x,y]=n.useState(!1),h=n.useCallback(p=>{p&&(f(p.canScrollPrev()),y(p.canScrollNext()))},[]),g=n.useCallback(()=>{o==null||o.scrollPrev()},[o]),j=n.useCallback(()=>{o==null||o.scrollNext()},[o]),b=n.useCallback(p=>{p.key==="ArrowLeft"?(p.preventDefault(),g()):p.key==="ArrowRight"&&(p.preventDefault(),j())},[g,j]);return n.useEffect(()=>{!o||!t||t(o)},[o,t]),n.useEffect(()=>{if(o)return h(o),o.on("reInit",h),o.on("select",h),()=>{o==null||o.off("select",h)}},[o,h]),e.jsx(Ts.Provider,{value:{carouselRef:m,api:o,opts:a,orientation:s||((a==null?void 0:a.axis)==="y"?"vertical":"horizontal"),scrollPrev:g,scrollNext:j,canScrollPrev:d,canScrollNext:x},children:e.jsx("div",{ref:u,onKeyDownCapture:b,className:I("relative",l),role:"region","aria-roledescription":"carousel",...i,children:c})})});Ps.displayName="Carousel";const As=n.forwardRef(({className:s,...a},t)=>{const{carouselRef:r,orientation:l}=Re();return e.jsx("div",{ref:r,className:"overflow-hidden",children:e.jsx("div",{ref:t,className:I("flex",l==="horizontal"?"-ml-4":"-mt-4 flex-col",s),...a})})});As.displayName="CarouselContent";const Ls=n.forwardRef(({className:s,...a},t)=>{const{orientation:r}=Re();return e.jsx("div",{ref:t,role:"group","aria-roledescription":"slide",className:I("min-w-0 shrink-0 grow-0 basis-full",r==="horizontal"?"pl-4":"pt-4",s),...a})});Ls.displayName="CarouselItem";const ga=n.forwardRef(({className:s,variant:a="outline",size:t="icon",...r},l)=>{const{orientation:c,scrollPrev:i,canScrollPrev:u}=Re();return e.jsxs(ae,{ref:l,variant:a,size:t,className:I("absolute  h-8 w-8 rounded-full",c==="horizontal"?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!u,onClick:i,...r,children:[e.jsx(mt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Previous slide"})]})});ga.displayName="CarouselPrevious";const ja=n.forwardRef(({className:s,variant:a="outline",size:t="icon",...r},l)=>{const{orientation:c,scrollNext:i,canScrollNext:u}=Re();return e.jsxs(ae,{ref:l,variant:a,size:t,className:I("absolute h-8 w-8 rounded-full",c==="horizontal"?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",s),disabled:!u,onClick:i,...r,children:[e.jsx(xt,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Next slide"})]})});ja.displayName="CarouselNext";const ya=()=>{const{id:s}=Ze(),[a]=Ee(),[t,r]=n.useState(),[l,c]=n.useState(0),{data:i,isLoading:u,error:m}=ma(s),{data:o=[],isLoading:d,error:f}=xa(s),x=u||d,y=m||f;if(y){console.error("Query error:",y);let g="Unknown error";y instanceof Error&&(g=y.message),a({message:`Error loading data: ${g}`,duration:3e3,color:"danger"})}n.useEffect(()=>{if(!t)return;const g=()=>{c(t.selectedScrollSnap())};return g(),t.on("select",g),t.on("reInit",g),()=>{t.off("select",g),t.off("reInit",g)}},[t]);const h=()=>{t&&t.scrollNext()};return e.jsxs(K,{children:[e.jsxs(F,{className:"",children:[e.jsx(J,{}),e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(v,{className:"rounded-lg",style:{"--border-radius":"0.5rem"},routerLink:`/set-overview/${s}`,children:[e.jsx(D,{slot:"start",icon:De}),"Back"]}),e.jsx("div",{children:x?e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(B,{name:"dots"}),e.jsx(B,{name:"dots"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-2xl font-bold",children:i==null?void 0:i.SetName}),e.jsx("p",{className:"text-gray-500",children:i==null?void 0:i.SetDescription})]})})]}),e.jsx("div",{className:"w-full max-w-xl mx-auto relative py-8 min-h-[400px] flex items-center justify-center",children:x?e.jsx(B,{name:"circular"}):o.length===0?e.jsx("div",{className:"text-center text-gray-500 text-lg py-20",children:"This set has no cards yet."}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{orientation:"vertical",setApi:r,className:"w-full",children:e.jsx(As,{className:"-mt-1 h-[400px]",children:o==null?void 0:o.map((g,j)=>e.jsx(Ls,{children:e.jsx(fa,{front:g.Front,back:g.Back,onAdvance:h,cardId:g.ID})},j))})}),e.jsx("div",{className:"absolute right-[-50px] top-1/2 transform -translate-y-1/2 flex flex-col gap-2",children:o==null?void 0:o.map((g,j)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${j===l?"bg-primary":"bg-gray-300"}`},j))})]})})]})]}),e.jsx(X,{})]})},pa=()=>{const[s,a]=n.useState("classes"),[t,r]=n.useState([]),[l,c]=n.useState([]),[i,u]=n.useState(!1),[m,o]=n.useState(!1),[d,f]=n.useState(null);return n.useEffect(()=>{const x=async()=>{u(!0),f(null);try{const h=await N("/api/class_user/classes");console.log("Classes: ",h),r(h)}catch(h){f(`Error fetching classes: ${h.message}`)}finally{u(!1)}},y=async()=>{o(!0);try{const h=await N("/api/set_user/list");console.log("Sets: ",h),c(h)}catch(h){f(`Error fetching sets: ${h.message}`)}finally{o(!1)}};x(),y()},[]),e.jsxs(K,{children:[e.jsxs(F,{children:[e.jsx(J,{}),e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8 flex-grow",children:[d&&e.jsx("div",{className:"text-red-500 mt-2",children:d}),e.jsxs("div",{className:"flex flex-col me:flex-row me:justify-between me:items-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-smokum font-bold",children:s==="classes"?"My Classes":"My Flashcard Sets"}),e.jsx("div",{className:"flex items-center gap-2 mt-4 me:mt-0",children:e.jsxs(v,{color:"primary",className:"rounded-lg",style:{"--border-radius":"0.5rem"},routerLink:s==="classes"?"/public-classes":"/public-cards",children:[e.jsx(D,{slot:"start",icon:We})," ",s==="classes"?"Join Class":"Join Set"]})})]}),e.jsx("div",{className:"mb-8",children:e.jsxs(ys,{value:s,onIonChange:x=>a(x.detail.value||"classes"),style:{"--background":"var(--ion-color-light)"},children:[e.jsxs(ge,{value:"classes",children:[e.jsx(D,{icon:ht,className:"mr-2"}),e.jsx(ue,{children:"My Classes"})]}),e.jsxs(ge,{value:"flashcards",children:[e.jsx(D,{icon:ps,className:"mr-2"}),e.jsx(ue,{children:"My Cards"})]})]})}),s==="classes"&&e.jsx(e.Fragment,{children:i?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(B,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading classes..."})]}):t===null?e.jsx("div",{className:"text-center p-8 text-gray-600",children:"You are not part of any classes. Join a class to get started."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:t==null?void 0:t.map(x=>e.jsx(me,{to:`/class/${x.ClassID}`,children:e.jsxs(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:[e.jsxs(Q,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(G,{className:"text-2xl font-semibold leading-none tracking-tight",children:x.ClassName}),e.jsx(ke,{className:"text-sm text-muted-foreground",children:x.ClassDescription})]}),e.jsx(z,{})]})},x.ClassID))})}),s==="flashcards"&&e.jsx(e.Fragment,{children:m?e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(B,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading sets..."})]}):l===null?e.jsx("div",{className:"text-center p-8 text-gray-600",children:"You are not part of any sets. Join a set to get started."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:l==null?void 0:l.map(x=>e.jsx(me,{to:`/set-overview/${x.SetID}`,children:e.jsxs(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:[e.jsxs(Q,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(G,{className:"text-2xl font-semibold leading-none tracking-tight",children:x.SetName}),e.jsx(ke,{className:"text-sm text-muted-foreground",children:x.SetDescription})]}),e.jsx(z,{})]})},x.SetID))})})]})]}),e.jsx(X,{})]})},wa=()=>e.jsx(K,{children:e.jsx(F,{children:e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center from-white to-gray-50",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-12 md:mb-16 mt-6 sm:mt-10 md:mt-14 mx-2",children:[e.jsx("h1",{className:"text-5xl sm:text-6xl md:text-7xl text-primary mb-4 font-ewert",children:"Cowboy Cards"}),e.jsx("p",{className:"text-lg sm:text-xl md:text-2xl font-rye",children:"Master any subject with smart flashcards"})]}),e.jsx(Ns,{})]})})}),va=()=>{const s=cs();return n.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",s.pathname)},[s.pathname]),e.jsx(K,{children:e.jsxs(F,{children:[e.jsx(J,{}),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),e.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),e.jsx("a",{href:"/home",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})]})})},Na=()=>{const[s,a]=n.useState(null),[t,r]=n.useState(!1),[l,c]=n.useState([]),[i,u]=n.useState(""),m=l.filter(o=>o.SetName.toLowerCase().includes(i.toLowerCase())||o.SetDescription&&o.SetDescription.toLowerCase().includes(i.toLowerCase()));return n.useEffect(()=>{async function o(){r(!0),a(null);try{const d=await N("/api/flashcards/sets/list");c(d)}catch(d){console.error("Error fetching flashcard sets:",d),a(`Error fetching flashcard sets: ${d.message}`)}finally{r(!1)}}o()},[]),e.jsxs(K,{children:[e.jsxs(F,{children:[e.jsx(J,{}),e.jsxs("div",{id:"main-content",className:"container mx-auto px-0 py-8 w-4/5",children:[e.jsxs("div",{className:"flex items-center flex-col justify-between mb-4",children:[e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum pb-8",children:"Public Flashcard Sets"}),t&&e.jsx("div",{children:"Loading..."}),s&&e.jsx("div",{className:"text-red-500 mt-2",children:s}),e.jsx(vs,{value:i,onIonInput:o=>u(o.target.value),placeholder:"Search flashcard sets",className:"mb-4 max-w-lg"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:m==null?void 0:m.map(o=>e.jsx(me,{to:`/flashcards/${o.ID}`,children:e.jsx(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:e.jsxs(Q,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(G,{className:"text-2xl font-semibold leading-none tracking-tight",children:o.SetName}),e.jsx(ke,{className:"text-sm ",children:o.SetDescription||"No description"})]})})},o.ID))})]})]}),e.jsx(X,{})]})},ba=()=>{const[s,a]=n.useState([]),[t,r]=n.useState(!1),[l,c]=n.useState(null),[i,u]=n.useState(""),m=s.filter(o=>o.ClassName.toLowerCase().includes(i.toLowerCase())||o.ClassDescription&&o.ClassDescription.toLowerCase().includes(i.toLowerCase()));return n.useEffect(()=>{(async()=>{r(!0),c(null);try{const d=await N("/api/classes/list");a(d)}catch(d){c(`Error fetching classes: ${d.message}`)}finally{r(!1)}})()},[]),e.jsxs(K,{children:[e.jsxs(F,{children:[e.jsx(J,{}),e.jsxs("div",{id:"main-content",className:"container mx-auto px-0 py-8 w-4/5",children:[e.jsxs("div",{className:"flex items-center flex-col justify-between mb-4",children:[e.jsx("h1",{className:"text-4xl tracking-wide font-bold font-smokum pb-8",children:"Public Classes"}),t&&e.jsx("div",{children:"Loading..."}),l&&e.jsx("div",{className:"text-red-500 mt-2",children:l}),e.jsx(vs,{value:i,onIonInput:o=>u(o.target.value),placeholder:"Search classes",className:"mb-4 max-w-lg"})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:m==null?void 0:m.map(o=>e.jsx(me,{to:`/class/${o.ID}`,children:e.jsx(O,{className:"cursor-pointer hover:shadow-lg hover:-translate-y-1 transition-transform-shadow duration-200 rounded-lg border shadow-sm",children:e.jsxs(Q,{className:"flex flex-col space-y-1.5 p-6",children:[e.jsx(G,{className:"text-2xl font-semibold leading-none tracking-tight",children:o.ClassName}),e.jsx(ke,{className:"text-sm ",children:o.ClassDescription||"No description"}),e.jsx(v,{expand:"block",color:"primary",className:"mt-4",onClick:async()=>{try{const d=await N("/api/class_user",{method:"POST",headers:{class_id:o.ID,role:"student"}});console.log("Join class response:",d)}catch(d){console.error("Error joining class:",d)}},children:"Join Class"})]})})},o.ID))})]})]}),e.jsx(X,{})]})},Ca=s=>{var t;const a=Array.isArray(s.cardsToDisplay)&&s.cardsToDisplay.length>0;return e.jsx("div",{className:"mt-8 min-h-[200px]",children:s.loading?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(B,{name:"circular"})}):!a&&!s.isEditing?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-lg text-gray-900 dark:text-gray-400 mb-4",children:"This set has no cards yet."}),s.isOwner&&e.jsx(v,{color:"primary",className:"rounded-lg",style:{"--border-radius":"0.5rem"},onClick:s.onAddCardClick,children:"Add Cards"})]}):e.jsxs("div",{className:"w-full",children:[(t=s.cardsToDisplay)==null?void 0:t.map((r,l)=>{var c,i,u,m;return s.isEditing&&s.isOwner?e.jsxs(O,{className:"mb-4 rounded-lg border shadow-sm p-4",children:[e.jsxs($,{lines:"none",children:[e.jsxs(W,{className:"text-md font-semibold text-gray-900 dark:text-gray-300 mr-auto",children:["Card ",l+1]}),e.jsx(v,{fill:"clear",color:"danger",size:"small",onClick:()=>s.onRemoveCard(l),children:e.jsx(D,{slot:"icon-only",icon:ws})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mt-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(xe,{label:"Front",labelPlacement:"stacked",value:r.Front,onIonInput:o=>s.onCardChange(l,"Front",o.detail.value),className:`w-full border rounded-md p-2 ${(c=s.cardErrors[l])!=null&&c.front?"border-red-500":"border-gray-300"}`,autoGrow:!0,rows:3}),((i=s.cardErrors[l])==null?void 0:i.front)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.cardErrors[l].front})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(xe,{label:"Back",labelPlacement:"stacked",value:r.Back,onIonInput:o=>s.onCardChange(l,"Back",o.detail.value),className:`w-full border rounded-md p-2 ${(u=s.cardErrors[l])!=null&&u.back?"border-red-500":"border-gray-300"}`,autoGrow:!0,rows:3}),((m=s.cardErrors[l])==null?void 0:m.back)&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:s.cardErrors[l].back})]})]})]},r.ID<=0?`new-${l}`:r.ID):e.jsx(O,{className:"mb-4 rounded-lg border shadow-sm",children:e.jsxs(z,{children:[e.jsx("div",{className:"border-b border-gray-300 mb-3 pb-1 m-4",children:e.jsxs(W,{className:"text-md font-semibold text-gray-900 dark:text-gray-300",children:["Card ",l+1]})}),e.jsxs("div",{className:"flex flex-row justify-between items-start",children:[e.jsx("div",{className:"w-3/12 pr-4 border-r border-gray-300 m-4",children:e.jsx(W,{className:"block whitespace-pre-wrap text-lg text-gray-900 dark:text-gray-200",children:r.Front})}),e.jsx("div",{className:"w-9/12 pl-4 m-4",children:e.jsx(W,{className:"block whitespace-pre-wrap text-lg text-gray-900 dark:text-gray-200",children:r.Back})})]})]})},r.ID)}),s.isEditing&&s.isOwner&&e.jsxs(v,{expand:"block",onClick:s.onAddCard,className:"mt-4 rounded-lg",children:[e.jsx(D,{slot:"start",icon:We}),"Add New Card"]})]})})},Sa=s=>e.jsxs(e.Fragment,{children:[s.isOwner&&!s.isEditing&&e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",style:{"--border-radius":"0.5rem"},onClick:s.onEditClick,children:"Edit Set & Cards"}),e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",color:"danger",style:{"--border-radius":"0.5rem"},onClick:s.onDeleteClick,children:"Delete Set"})]}),s.isOwner&&s.isEditing&&e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",color:"primary",size:"small",onClick:s.onSaveClick,children:"Save All Changes"}),e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",color:"medium",size:"small",onClick:s.onCancelClick,children:"Cancel"})]}),e.jsx(v,{className:"rounded-lg flex-grow md:flex-grow-0",color:"primary",style:{"--border-radius":"0.5rem"},routerLink:s.studyLink,disabled:s.isEditing,children:"Study Set"})]}),ka=s=>e.jsxs("div",{className:"gap-4 flex-1 pr-4",children:[e.jsx("div",{className:"flex flex-col",children:s.loading||!s.flashcardSetData?e.jsx(B,{name:"dots"}):s.isEditing&&s.isOwner?e.jsxs(e.Fragment,{children:[e.jsx(oe,{type:"text",label:"Set Name",name:"set_name",value:s.updatedInfo.set_name,onChange:s.onMetadataChange,error:s.metadataErrors.setName}),e.jsx(oe,{type:"text",label:"Set Description",name:"set_description",value:s.updatedInfo.set_description,onChange:s.onMetadataChange,error:s.metadataErrors.setDescription}),s.metadataErrors.general&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.metadataErrors.general})]}):e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl font-bold",children:s.flashcardSetData.SetName||"Untitled Set"}),e.jsx("p",{className:"text-base mt-1 text-gray-700",children:s.flashcardSetData.SetDescription||"No description available"})]})}),e.jsxs(v,{className:"rounded-lg flex-grow md:flex-grow-0 mt-4",style:{"--border-radius":"0.5rem"},onClick:s.onBackClick,disabled:s.isEditing,children:[e.jsx(D,{slot:"start",icon:De}),"Back"]})]});function Ia(s){return re({queryKey:["set",s],queryFn:()=>N("/api/flashcards/sets/",{method:"GET",headers:{id:s}}),staleTime:5*60*1e3})}function Ea(s){return re({queryKey:["setCards",s],queryFn:()=>N("/api/flashcards/list",{method:"GET",headers:{set_id:s}}),staleTime:5*60*1e3})}function Da(){const s=ne();return le({mutationFn:({id:a,field:t,value:r})=>N(`/api/flashcards/sets/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["set",t.id]})}})}function Ta(){const s=ne();return le({mutationFn:({id:a,field:t,value:r})=>N(`/api/flashcards/${t}`,{method:"PUT",headers:{id:a,[t]:r}}),onSuccess:(a,t)=>{const l=s.getQueryCache().findAll({queryKey:["setCards"]}).map(c=>c.queryKey[1]).find(c=>{const i=s.getQueryData(["setCards",c]);return i==null?void 0:i.some(u=>u.ID===t.id)});l&&s.invalidateQueries({queryKey:["setCards",l]})}})}function Pa(){const s=ne();return le({mutationFn:({setId:a,front:t,back:r})=>N("/api/flashcards",{method:"POST",headers:{front:t,back:r,set_id:a}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["setCards",t.setId.toString()]})}})}function Aa(){const s=ne();return le({mutationFn:a=>N("/api/flashcards",{method:"DELETE",headers:{id:a}}),onSuccess:(a,t)=>{const l=s.getQueryCache().findAll({queryKey:["setCards"]}).map(c=>c.queryKey[1]).find(c=>{const i=s.getQueryData(["setCards",c]);return i==null?void 0:i.some(u=>u.ID===t)});l&&s.invalidateQueries({queryKey:["setCards",l]})}})}function La(){const s=ne();return le({mutationFn:a=>N("/api/flashcards/sets/",{method:"DELETE",headers:{id:a}}),onSuccess:(a,t)=>{s.invalidateQueries({queryKey:["set",t]}),s.invalidateQueries({queryKey:["setCards",t]}),s.invalidateQueries({queryKey:["userSets"]})}})}const _a=()=>{const{id:s}=Ze(),a=pe(),[t]=Ee(),{data:r,isLoading:l,error:c}=Ia(s),{data:i=[],isLoading:u,error:m}=Ea(s),o=Da(),d=Ta(),f=Pa(),x=Aa(),y=La(),[h,g]=n.useState(!1),[j,b]=n.useState(!1),[p,V]=n.useState([]),[q,S]=n.useState({set_name:"",set_description:""}),[T,Z]=n.useState({}),[ie,ee]=n.useState({}),E=(r==null?void 0:r.Role)==="owner",k=l||u,U=c||m;if(U){console.error("Query error:",U);let C="Unknown error";U instanceof Error&&(C=U.message),t({message:`Error loading data: ${C}`,duration:3e3,color:"danger"})}const _=()=>{r&&(S({set_name:r.SetName||"",set_description:r.SetDescription||""}),V(i==null?void 0:i.map(C=>({...C}))),b(!0),Z({}),ee({}))},Me=C=>{const{name:P}=C.target,A=C.detail.value??"";S(w=>({...w,[P]:A}))},Ue=(C,P,A)=>{const w=A??"";V(L=>L==null?void 0:L.map((ce,fe)=>fe===C?{...ce,[P]:w}:ce))},$e=()=>{if(!r)return;const C={ID:0-p.filter(P=>P.ID<=0).length-1,Front:"",Back:"",SetID:r.ID,CreatedAt:new Date().toISOString(),UpdatedAt:new Date().toISOString()};V(P=>[...P,C])},Be=C=>{V(P=>P.filter((A,w)=>w!==C))},ze=()=>{const C={};let P=!0;const A=q.set_name.trim(),w=q.set_description.trim();return A||(C.setName="Set name is required",P=!1),w||(C.setDescription="Set description is required",P=!1),Z(C),S({set_name:A,set_description:w}),P},Ke=()=>{const C={};let P=!0;return p.forEach((A,w)=>{const L={},ce=A.Front.trim(),fe=A.Back.trim();ce||(L.front="Front cannot be empty",P=!1),fe||(L.back="Back cannot be empty",P=!1),Object.keys(L).length>0&&(C[w]=L),(ce!==A.Front||fe!==A.Back)&&V(Qe=>Qe==null?void 0:Qe.map((es,_s)=>_s===w?{...es,Front:ce,Back:fe}:es))}),ee(C),P},we=async()=>{const C=ze(),P=Ke();if(!C||!P||!r){console.log("Form validation failed:",T,ie),t({message:"Please fix validation errors before saving.",duration:3e3,color:"warning"});return}try{q.set_name!==(r.SetName||"").trim()&&await o.mutateAsync({id:s,field:"set_name",value:q.set_name}),q.set_description!==(r.SetDescription||"").trim()&&await o.mutateAsync({id:s,field:"set_description",value:q.set_description});const A=new Map(i==null?void 0:i.map(w=>[w.ID,w]));for(const w of i)!p.some(L=>L.ID===w.ID)&&w.ID>0&&await x.mutateAsync(w.ID);for(const w of p)if(w.ID<=0)await f.mutateAsync({setId:r.ID,front:w.Front,back:w.Back});else{const L=A.get(w.ID);L&&(w.Front!==(L.Front||"").trim()&&await d.mutateAsync({id:w.ID,field:"front",value:w.Front}),w.Back!==(L.Back||"").trim()&&await d.mutateAsync({id:w.ID,field:"back",value:w.Back}))}t({message:"Set details and cards updated successfully!",duration:2e3,color:"success"}),b(!1),Z({}),ee({})}catch(A){console.error("Failed to update set:",A);let w="Unknown error during save";A instanceof Error&&(w=A.message),Z(L=>({...L,general:`Failed to save: ${w}`})),t({message:`Failed to save changes: ${w}`,duration:3e3,color:"danger"})}},ve=()=>{b(!1),Z({}),ee({})},R=async()=>{if(!s){console.error("Cannot delete set: ID is missing."),t({message:"Cannot delete: Set ID missing.",duration:3e3,color:"danger"});return}try{await y.mutateAsync(s),t({message:"Set deleted successfully.",duration:2e3,color:"success"}),a.push("/student-dashboard")}catch(C){console.error("Failed to delete set:",C);let P="Unknown error during deletion";C instanceof Error&&(P=C.message),t({message:`Failed to delete set: ${P}`,duration:3e3,color:"danger"})}},se=()=>{j||window.history.back()},Ve=j?p:i;return k&&!j?e.jsxs(K,{children:[e.jsxs(F,{className:"",children:[e.jsx(J,{}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(B,{name:"circular"})})]}),e.jsx(X,{})]}):e.jsxs(K,{children:[e.jsxs(F,{className:"",children:[e.jsx(J,{}),e.jsxs("div",{id:"main-content",className:"container max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start gap-4 mb-6",children:[e.jsx(ka,{loading:k,flashcardSetData:r,isEditing:j,isOwner:E,updatedInfo:q,metadataErrors:T,onMetadataChange:Me,onBackClick:se}),e.jsx(Sa,{isOwner:E,isEditing:j,onBackClick:se,onEditClick:_,onSaveClick:we,onCancelClick:ve,onDeleteClick:()=>g(!0),studyLink:`/flashcards/${s}`})]}),e.jsx(Ca,{loading:k,cardsToDisplay:Ve,isEditing:j,isOwner:E,cardErrors:ie,onCardChange:Ue,onAddCard:$e,onRemoveCard:Be,onAddCardClick:_})]}),e.jsx(Se,{isOpen:h,onDidDismiss:()=>g(!1),header:"Confirm Deletion",message:"Are you sure you want to delete this set? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",cssClass:"secondary"},{text:"Delete",role:"destructive",handler:R}]})]}),e.jsx(X,{})]})},te=s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"font-medium",children:[s.label,":"]}),e.jsx("span",{children:s.value})]}),Fa=s=>{var a,t,r,l,c,i,u,m,o,d,f,x,y,h;return e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsxs(O,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(Q,{className:"p-6",children:e.jsx(G,{className:"text-xl font-rye font-semibold text-primary",children:"Account Information"})}),e.jsx(z,{className:"p-6 pt-0",children:s.isEditing?e.jsxs("div",{className:"space-y-4",children:[e.jsx(oe,{type:"text",label:"First Name",name:"first_name",value:((a=s.updatedInfo)==null?void 0:a.first_name)||"",error:s.errors.first_name,onChange:s.handleChange}),e.jsx(oe,{type:"text",label:"Last Name",name:"last_name",value:((t=s.updatedInfo)==null?void 0:t.last_name)||"",error:s.errors.last_name,onChange:s.handleChange}),e.jsx(oe,{type:"text",label:"Username",name:"username",value:((r=s.updatedInfo)==null?void 0:r.username)||"",error:s.errors.username,onChange:s.handleChange}),e.jsx(oe,{type:"email",label:"Email",name:"email",value:((l=s.updatedInfo)==null?void 0:l.email)||"",error:s.errors.email,onChange:s.handleChange}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx(v,{onClick:s.handleSave,children:"Save Changes"})})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(te,{label:"First Name",value:(c=s.userInfo)==null?void 0:c.first_name}),e.jsx(te,{label:"Last Name",value:(i=s.userInfo)==null?void 0:i.last_name}),e.jsx(te,{label:"Username",value:(u=s.userInfo)==null?void 0:u.username}),e.jsx(te,{label:"Email",value:(m=s.userInfo)==null?void 0:m.email}),e.jsxs(v,{onClick:s.handleEdit,className:"mt-4",children:[e.jsx(D,{slot:"start",icon:Xe}),"Edit Info"]})]})})]}),e.jsxs(O,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(Q,{className:"p-6",children:e.jsx(G,{className:"text-xl font-rye font-semibold text-primary",children:"Account Stats"})}),e.jsx(z,{className:"p-6 pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(te,{label:"Account Created",value:(o=s.userInfo)==null?void 0:o.created_at}),e.jsx(te,{label:"Login Streak",value:(d=s.userInfo)==null?void 0:d.login_streak}),e.jsx(te,{label:"Classes Taken",value:(f=s.userInfo)==null?void 0:f.numClasses}),e.jsx(te,{label:"Cards Mastered/Studied",value:`${(x=s.userInfo)==null?void 0:x.cardsMastered} / ${(y=s.userInfo)==null?void 0:y.cardsStudied}`}),e.jsx(te,{label:"Total Card Views",value:(h=s.userInfo)==null?void 0:h.totalCardViews})]})})]})]})},ls=256;function Oa(s){const[a,t]=n.useState(0),{ref:r,inView:l}=ft({threshold:.7,triggerOnce:!0});return n.useEffect(()=>{let c=1e3;if(l){const i=setTimeout(()=>t(a+1),c*=.75);a==s.streak-1&&clearTimeout(i)}},[a,s.streak,l]),e.jsxs(O,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(Q,{className:"p-6",children:e.jsx(G,{className:"text-xl font-rye font-semibold text-primary",children:"Login Streak"})}),e.jsxs(z,{ref:r,className:"py-6 px-0 flex flex-row items-center justify-center gap-8",children:[e.jsx("img",{src:`/frame-${a}.png`,alt:"bonsai tree",width:ls,height:ls}),e.jsx("span",{className:"text-6xl px-4 font-rye font-extrabold text-[color:--ion-color-primary] tabular-nums -ml-[30%] me:ml-0",children:a+1})]})]})}const qa=s=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-6 py-6",children:[e.jsx(Oa,{streak:s.streak}),e.jsxs(O,{className:"md:w-1/2 rounded-lg border shadow-sm",children:[e.jsx(Q,{className:"p-6",children:e.jsx(G,{className:"text-xl font-rye font-semibold text-primary",children:"Account Options"})}),e.jsx(z,{className:"p-6 pt-0",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs(gt,{label:"Theme",value:s.theme,onIonChange:a=>s.setTheme(a.detail.value),interface:"popover",placeholder:"Select Theme",children:[e.jsx(ts,{value:"light",children:"Light"}),e.jsx(ts,{value:"dark",children:"Dark"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mr-4",children:[e.jsx("h4",{className:"text-sm font-medium text-black dark:text-white",children:"Change Your Password"}),e.jsx("p",{className:"text-xs dark:text-gray-300",children:"Reset your account password."})]}),e.jsx(v,{color:"primary",onClick:()=>s.setShowPasswordAlert(!0),children:"Change Password"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"mr-4",children:[e.jsx("h4",{className:"text-sm font-medium text-black dark:text-white",children:"Delete Your Account"}),e.jsx("p",{className:"text-xs dark:text-gray-300",children:"This will delete all account data and can't be undone."})]}),e.jsx(v,{color:"danger",onClick:()=>s.setShowDeleteAlert(!0),children:"Delete Account"})]})]})})]})]}),e.jsx(Se,{isOpen:s.showPasswordAlert,onDidDismiss:()=>s.setShowPasswordAlert(!1),header:"Change Password",inputs:[{name:"oldPassword",type:"password",placeholder:"Old Password"},{name:"newPassword",type:"password",placeholder:"New Password"},{name:"confirmPassword",type:"password",placeholder:"Confirm New Password"}],buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Save",handler:a=>a.newPassword!==a.confirmPassword?(s.presentToast({message:"Passwords do not match",duration:2e3,color:"danger"}),!0):(console.log("Password changed"),!0)}]}),e.jsx(Se,{isOpen:s.showDeleteAlert,onDidDismiss:()=>s.setShowDeleteAlert(!1),header:"Confirm Deletion",message:"Are you sure you want to delete your account? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Delete",handler:()=>{console.log("Account deleted")}}]})]}),Ra=()=>{const{theme:s,setTheme:a}=Ds(),[t,r]=n.useState(),[l,c]=n.useState(!0),[i,u]=n.useState(null),[m,o]=n.useState(null),[d,f]=n.useState(!1),[x,y]=n.useState(!1),[h,g]=n.useState(!1),[j,b]=n.useState(t),p=E=>{o(m===E?null:E)},V=()=>{b(t),g(!0)},q=async()=>{var k;if(!S())return;const E=["first_name","last_name","username","email"];try{const U=(k=E==null?void 0:E.filter(_=>j[_]!==t[_]))==null?void 0:k.map(_=>N(`/api/users/${_}`,{method:"PUT",headers:{[_]:j[_]}}));await Promise.all(U),r(j),g(!1)}catch(U){console.error(U),alert("Failed to update some fields. Please try again.")}},S=()=>{const E={};let k=!0;return j.first_name||(E.first_name="First name is required",k=!1),j.last_name||(E.last_name="Last name is required",k=!1),j.email?/\S+@\S+\.\S+/.test(j.email)||(E.email="Email is invalid",k=!1):(E.email="Email is required",k=!1),j.username||(E.username="Username is required",k=!1),j.first_name=j.first_name.trim(),j.last_name=j.last_name.trim(),j.email=j.email.trim(),j.username=j.username.trim(),Z(E),k},[T,Z]=n.useState({}),ie=E=>{const{name:k}=E.target,U=E.detail.value;b(_=>({..._,[k]:U}))};n.useEffect(()=>{(async()=>{c(!0),u(null);try{const k=await N("/api/users/",{method:"GET",headers:{}});r(k),b(k),console.log("data",k)}catch(k){console.log(`Failed to fetch User Data: ${k.message}`),u(`Failed to fetch User Data: ${k.message}`)}finally{c(!1)}})()},[]);const[ee]=Ee();return e.jsxs(K,{children:[e.jsxs(F,{children:[e.jsx(J,{}),e.jsxs("div",{id:"main-content",className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("p",{className:"text-xl font-rye font-semibold text-primary",children:["Welcome back, ",(t==null?void 0:t.username)||"User","!"]})}),e.jsxs(v,{onClick:()=>window.history.back(),className:"mb-6",children:[e.jsx(D,{slot:"start",icon:De}),"Back"]}),l&&e.jsxs("div",{className:"flex justify-center items-center p-8",children:[e.jsx(B,{name:"circular"}),e.jsx("span",{className:"ml-2",children:"Loading account details..."})]}),i&&!l&&e.jsx("div",{className:"text-red-500 text-center p-4 border border-red-500 rounded-md",children:i}),!l&&!i&&t&&e.jsxs(e.Fragment,{children:[e.jsx(Fa,{isEditing:h,errors:T,handleChange:ie,handleSave:q,updatedInfo:j,userInfo:t,handleEdit:V}),e.jsx(qa,{streak:(t==null?void 0:t.login_streak)??0,isEditing:h,errors:T,handleChange:ie,handleSave:q,updatedInfo:j,userInfo:t,expandedClass:m,toggleClassDetails:p,showPasswordAlert:d,setShowPasswordAlert:f,showDeleteAlert:x,setShowDeleteAlert:y,theme:s,setTheme:a,presentToast:ee})]})]})]}),e.jsx(X,{})]})};jt();const Ma=new yt;function Ua(){return e.jsx(pt,{client:Ma,children:e.jsx(Vt,{children:e.jsxs(zt,{children:[e.jsx(wt,{children:e.jsx(vt,{children:e.jsx(n.Suspense,{fallback:e.jsx("div",{children:"Loading..."}),children:e.jsxs(Nt,{children:[e.jsx(M,{exact:!0,path:"/",component:wa}),e.jsx(M,{exact:!0,path:"/home",component:pa}),e.jsx(M,{exact:!0,path:"/class/:id",component:ca}),e.jsx(M,{exact:!0,path:"/auth",component:Ns}),e.jsx(M,{exact:!0,path:"/reset-password",component:qt}),e.jsx(M,{exact:!0,path:"/confirm-reset-password",component:Ot}),e.jsx(M,{exact:!0,path:"/public-cards",component:Na}),e.jsx(M,{exact:!0,path:"/user-account",component:Ra}),e.jsx(M,{exact:!0,path:"/flashcards/:id",component:ya}),e.jsx(M,{exact:!0,path:"/create-set",component:ua}),e.jsx(M,{exact:!0,path:"/create-class",component:da}),e.jsx(M,{exact:!0,path:"/public-classes",component:ba}),e.jsx(M,{exact:!0,path:"/set-overview/:id",component:_a}),e.jsx(M,{component:va})]})})})}),e.jsx(Bt,{}),e.jsx(Rt,{})]})})})}const $a=document.getElementById("root"),Ba=bt($a);Ba.render(e.jsx(Ua,{}));export{Qa as _,Va as g};
//# sourceMappingURL=index-DQ_HVg3t.js.map
